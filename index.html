<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Video subtitle by vietank</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
    <style>
        .display-cues {
            width: 400px;
            float: left;
            margin-left: 10px;
			padding-left: 5px;
            height: 300px;
            overflow-y: scroll;
			border: solid 1px #999999;
        }
		.display-cues p{
			font-size: 14px;
		}
        .cue-active {
            background-color: #84c9b6;
        }
    </style>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Video subtitle</h1>
      <h2 class="project-tagline">Subtitles outside html5 video player</h2>
      <a href="https://github.com/vietank/video-subtitle" class="btn">View on GitHub</a>
      <a href="https://github.com/vietank/video-subtitle/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/vietank/video-subtitle/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
		<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demo</h3>
		<div style="display: table;width: 100%;">
			<div style="width: 535px;float: left;">
				<video class="bigschool-video" style="width: 100%;" id="video-1" controls>
					<source src="developerStories-en.webm">
					<track onload="onTrackLoad(1);" id="entrack-1" label="English subtitles" kind="captions" src="entrack.vtt" srclang="en" default>
				</video>
		   
			</div>
			<div id="display-cues-1" class="display-cues">
				<p id="start-point-1"><p>
			</div>
		</div>
		<div style="display: table;width: 100%;">
			<div style="width: 535px;float: left;">
				<video class="bigschool-video" style="width: 100%;" id="video-2" controls>
					<source src="mov_bbb.mp4">
					<track onload="onTrackLoad(2);" id="entrack-2" label="English subtitles" kind="captions" src="entrack-2.vtt" srclang="en" default>
				</video>
		   
			</div>
			<div id="display-cues-2" class="display-cues">
				<p id="start-point-2"><p>
			</div>
		</div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/vietank/video-subtitle">Video subtitle</a> is maintained by <a href="https://github.com/vietank">vietank</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>
    <script>
        $(document).ready(function() {
			var cuesTime = [];
			var onHover = [];
			jumpToTime = function (video_id, t){
				document.getElementById('video-' + video_id).currentTime = t + 0.01;
			}
            onTrackLoad = function(video_id) {
                var track = document.getElementById("entrack-"+video_id).track; // get text track from track element          
                var cues = track.cues;
                //console.log(cues);
                // get list of cues                    
                for (var i = 0; i < cues.length; i++) {		
					if(i == 0){
						cuesTime[video_id] = [];
						cuesTime[video_id][i] = 0;
						$('#display-cues-'+video_id).append('<p onclick="jumpToTime(' + video_id + ', ' + cues[i].startTime + ')" data-start-time-video-' + video_id + '="0" class="cue-active">' + cues[i].text + '</p>');				
					}else{
						cuesTime[video_id][i] = cues[i].startTime;
						$('#display-cues-'+video_id).append('<p onclick="jumpToTime(' + video_id + ', ' + cues[i].startTime + ')" data-start-time-video-' + video_id + '="' + cues[i].startTime + '">' + cues[i].text + '</p>');
					}
                }

				onHover[video_id] = false;
				$('#display-cues-'+video_id).scrollTop(0);
				//track.mode = "hidden"; 
            }

            $(".bigschool-video").on(
                "timeupdate",
                function(event) {
					var video_id = (this.id).substring(6);
					//console.log(video_id);
                    var currentTime = this.currentTime;
                   
					
					var cueTimeCurrent = 0;
					for (var i = 0; i < cuesTime[video_id].length; i++) {
						if((currentTime - cuesTime[video_id][i]) <= 0){
							cueTimeCurrent = cuesTime[video_id][i-1];
							break;
						}
						cueTimeCurrent = cuesTime[video_id][i];
					}
					if(currentTime == 0){
						cueTimeCurrent = 0;
					}
					
					$('#display-cues-' + video_id + ' .cue-active').removeClass('cue-active');
					$('[data-start-time-video-' + video_id + '="' + cueTimeCurrent + '"]').addClass('cue-active');
					
					var offsetTop = $('[data-start-time-video-' + video_id + '="' + cueTimeCurrent + '"]').offset().top - $('#start-point-'+video_id).offset().top;
					if(!onHover[video_id]){
						$('#display-cues-' + video_id).scrollTop(offsetTop - 150);
					}
					//console.log(offsetTop);
				});
			
			$('.display-cues').hover(function(event){
				var video_id = (this.id).substring(13);
				onHover[video_id] = true;
			}, function (){
				var video_id = (this.id).substring(13);
				onHover[video_id] = false;
			})
        })
    </script>
  </body>
</html>
